const mongoose = require('mongoose');
const config = require("config");

const CompanyModel = require('../app/models/Company');
const RepresentativeModel = require('../app/models/Representative');
const CategoryModel = require('../app/models/Category');
const ProductModel = require('../app/models/Product');

const dropData = function (done) {
    CompanyModel.remove({}, function () {
        RepresentativeModel.remove({}, function () {
            CategoryModel.remove({}, function () {
                ProductModel.remove({}, done);
            });
        });
    });
};

const createCompanys= function(done){
    const company1 = new CompanyModel({
        login: "admin@sony.com",
        password: "1234",
        name: "Sony"
    });

    const company2 = new CompanyModel({
        login: "admin@onkyo.com",
        password: "1234",
        name: "Onkyo"
    });

    const company3 = new CompanyModel({
        login: "admin@samsung.com",
        password: "1234",
        name: "Samsung"
    });

    company1.save(function() {
        company2.save(function () {
           company3.save(function () {
               done([company1, company2, company3]);
           });
        });
    });
};

const createRepresentas = function (company ,done) {
    const represent1 = new RepresentativeModel({
        login: "eyuel@" + company.name.toLowerCase() + ".com",
        password: "1234",
        name: "Eyuel",
        company: company._id
    });

    const represent2 = new RepresentativeModel({
        login: "amir@sony.com",
        password: "1234",
        name: "Amir",
        company: company._id
    });
    const represent3 = new RepresentativeModel({
        login: "prasannjeet@sony.com",
        password: "1234",
        name: "Prasannjeet",
        company: company._id
    });

    const represent4 = new RepresentativeModel({
        login: "weibin@sony.com",
        password: "1234",
        name: "Weibin",
        company: company._id
    });

    const represent5 = new RepresentativeModel({
        login: "ayesha@sony.com",
        password: "1234",
        name: "Ayesha",
        company: company._id
    });

    const represent6 = new RepresentativeModel({
        login: "martin@sony.com",
        password: "1234",
        name: "Martin",
        company: company._id
    });

    const batchInsert = [represent1, represent2, represent3, represent4, represent5, represent6];
    RepresentativeModel.collection.insert(batchInsert, done);
};

const createCategories = function(done){

   const cat = [
        "Televisions",
            "LED",
            "OLED",
            "Flat",
            "Curved",
            "TV Accessories",
                "Cables",
                "Cast Devices",

        "Home Entertainment Systems",	"Bestsellers",
            "Home Theater",
            "Televisions",
            "Speakers",
                "Bluetooth Speakers",
                "Bookshelf Speakers",
                "Ceiling and In Wall Speakers",
                "Centre Speakers",
                "Outdoor Speakers",
                "Satellite Speakers",
                "Soundbar Speakers",
                "Speaker Systems",
                "Subwoofers",
                "Tower Speakers",
            "Sound Bars",
            "DVD Players and Recorders",
            "Streaming Media Players",
            "Set Top Boxes",

        "Projectors",
            "Projector Accessories",
                "Cables",
                "Projector Screens",
                "Projector Bags & Cases",
                "Projector Lamps",
                "Projector Lenses",
                "Projector Mounts",
                "Projector Stands",

        "Modems and Routers",
            "Modems",
            "Routers",
            "Data Cards and Dongles",
            "Wireless USB Adaptors",
            "Switch",
            "Repeaters",

        "Headphones",
            "In Ear",
            "On Ear",
            "Over Ear",
            "Noice Cancelling",
            "Sports and Fitness",
            "Tangle Free Cord",
            "With Microphone",
            "Withouth Microphone",

        "MP3, Media Players & Accessories",
            "Media Player Accessories",
            "Boomboxes",
            "DVD And Blu Ray Players",
            "MP3 & MP4 Players",

        "Audio & Video Accessories",
            "3D Glasses",
            "Cables",
            "Headphones",
            "Headphone Accessories",
            "Projector Accessories",
            "Remote Controls",
            "TV Mounts & Stands",
            "Turntable Cartridges & Needles",
            "Video Converters",

        "Cameras",
            "Camera Accessories",
                "Batteries & Charges",
                "Caliberation Charts & Grey Cards",
                "Camcorder & Video Accessories",
                "Case & Bag Accessories",
                "Cases & Bags",
                "Cleaners",
                "Digital Camera Accessories",
                "Filters",
                "Flash Accessories",
                "Lens Accessories",
                "Photo Studio & Lightning",
                "Telescope Accessories",
                "Tripod & Monopod Accessories",
            "Action Cameras",
            "Binoculars",
            "Camcorders",
            "Digital Cameras",
            "Digital Picture Frames",
            "Film Cameras",
            "Flashes",
            "Survelliance Cameras",
            "Tripods & Monopods",
            "Underwater Video & Photography",
            "Video Projectors",

        "DSLR Cameras",

        "Camera Accessories",

        "Musical Instruments & Professional Audio",
            "Bass Guitars & Gear",
            "DJ & VJ Equipment",
            "Drums & Percussion",
            "Guitars & Gear",
            "Karaoke Equipment",
            "Microphone",
            "PA & Stage",
            "Piano & Keyboard",
            "Recording & Computer",
            "String Instruments",
            "Synthesizer & Sampler",
            "Wind Instruments",

        "Gaming Consoles",

        "Heating & Cooling Appliances",
            "Air Coolers",
            "Air Purifiers",
            "Dehumidifiers",
            "Fans",
            "Humidifiers",
            "Room Heaters",
            "Water Heaters",

        "Air Conditioners",
            "Window AC",
            "Split AC",

        "Refrigerators",
            "Multi Door",
            "Side By Side",
            "Standard Double Door",
            "Standard Single Door",

        "Washing Machines",
            "Top Loading",
            "Front Loading",
            "Fully Automatic",
            "Semi Automatic",

        "Kitchen & Home Appliances",
            "Mixer Grinders",
            "Juicers",
            "Food Processors",
            "Rice & Pasta Cookers",
            "Induction Cookers",
            "Espresso Machines",
            "Over Toaster Grills",
            "Kettles",
            "Toasters",
            "Sandwich Makers",
            "Stand Mixers",
    ];

   let categories = [];


   function increment (j){
        j+=1;
        return j;
    }

    function addCategories(x){
        const cat_entity = new CategoryModel({
            name: cat[x]
        });
        cat_entity.save(function(err, result){
            categories.push(cat_entity);
            if (x === cat.length-1){
                done(categories);
            }else{
                addCategories(increment(x));
            }

        });
    }
    addCategories(0);
};

const createProducts = function (companies, categories, done) {
    let companySamsung;
    let companySony;
    for(let i = 0; i < companies.length; i++){
        if(companies[i].name === "Samsung"){
            companySamsung = companies[i];
        }else if(companies[i].name === "Sony"){
            companySony = companies[i];
        }
    }

    let categoryTv;
    let categoryCabel;
    let categoryProjector;

    for(let k = 0; k < categories.length; k++){
        if(categories[k].name === "Televisions"){
            categoryTv = categories[k];
        }else if(categories[k].name === "Cables"){
            categoryCabel = categories[k];
        }else if(categories[k].name === "Projectors"){
            categoryProjector = categories[k];
        }
    }

    const productSamsungTv = new ProductModel({
        productName : "SamsungTV55",
        company_id: companySamsung._id,
        categories: [categoryTv],
        productImages: [
            "https://storage.googleapis.com/product_resources/5c379607-0992-4b86-bf2e-baf9c3f5aada_41fcmkyAH8L._SL1000_.jpg",
            "https://storage.googleapis.com/product_resources/a3b8737b-ca30-4ed6-8cdb-3d58ce0a17b4_41ZTemqcTbL.jpg",
            "https://storage.googleapis.com/product_resources/4075311e-353f-4fd6-81a4-85b62e64df5a_616+K6M825L._SL1000_.jpg",
            "https://storage.googleapis.com/product_resources/e8246037-bf21-4dae-98ad-8749fa968080_61O-zVbQEyL._SL1000_.jpg"
        ],
        productResources: [
            "https://storage.googleapis.com/product_resources/3930f886-470c-4ff4-9732-c0262766f43f_Flyer_C109100111.pdf",
            "https://storage.googleapis.com/product_resources/72b9f8c8-eb74-4479-8802-0b1f814d4806_[ME65B ME75B]User manual.pdf"
        ]
    });

    const productSonyHdmiCabel = new ProductModel({
        productName : "HDMI Cabel",
        company_id: companySamsung._id,
        categories: [categoryTv , categoryCabel],
        productImages: [
            "https://storage.googleapis.com/product_resources/8d16bae2-7e79-4bca-8714-d9188bf45d56_hdmi.jpeg"
        ],
        productResources: []
    });

    const productSonyTv = new ProductModel({
        productName : "Sony KDL-32WD755",
        company_id: companySony._id,
        categories: [categoryTv],
        productImages: [
            "https://storage.googleapis.com/product_resources/0db29e7e-8b70-449e-a51a-a7c635020626_71FDTYs2kYL._SL1000_.jpg",
            "https://storage.googleapis.com/product_resources/ba8e7bfe-05c5-4622-9d7c-f5233d4a79c1_518auH+ElmL._SL1344_.jpg",
            "https://storage.googleapis.com/product_resources/c263a0f4-38a1-48e6-8754-e0e77ceb2458_71aoslUBdhL._SL1000_.jpg",
            "https://storage.googleapis.com/product_resources/471e7dcb-8af2-48cf-a4b4-ed64230b8675_916UZhZsh-L._SL1500_.jpg",
            "https://storage.googleapis.com/product_resources/310f7ec2-850d-40c4-961f-2b469101ccbc_71z8ywLQ0YL._SL1000_.jpg",
            "https://storage.googleapis.com/product_resources/fb88aeed-2721-4fcc-8c2c-76e35651bc8d_61+oO5RZE1L._SL1500_.jpg",
        ],
        productResources: [
            "https://storage.googleapis.com/product_resources/38dbd383-d127-40a3-a0b7-57932daee8c9_model-home (1).html",
            "https://storage.googleapis.com/product_resources/6212db00-6a14-4831-98ca-181be0f8edab_model-home.html",
            "https://storage.googleapis.com/product_resources/32f7bbff-32f1-47e4-9c0e-b0bddc43a9de_61PD-e9L3vL._SL1500_.jpg",
            "https://storage.googleapis.com/product_resources/e098394f-563e-4884-a2ed-48f190637625_Ref_4562216131_EN_FR.pdf"
        ]
    });

    const productSamsungProjector = new ProductModel({
        productName : "Flux Supa Projector",
        company_id: companySamsung._id,
        categories: [categoryProjector],
        productImages: [
            "https://storage.googleapis.com/product_resources/12c09990-50d7-4f38-b76f-364627fc53df_908sama800.1.jpg"
        ],
        productResources: [
            "https://storage.googleapis.com/product_resources/5256e03b-33b3-4aab-96ac-674907581f28_ex3210ug.pdf"
        ]
    });

    const batchInsert = [productSamsungTv, productSonyHdmiCabel, productSonyTv, productSamsungProjector];
    ProductModel.collection.insert(batchInsert, function(){
        done(batchInsert);
    });
};
mongoose.connect(config.database.connectionURL, { useMongoClient: true });
mongoose.Promise = global.Promise;

console.log("Setup Databse");
console.log("---");

console.log("Drop Data");
dropData(function () {
    console.log("Add Data");
    createCompanys(function (companies) {
       for(let i = 0; i < companies.length; i++){
           createRepresentas(companies[i], function(){

           });
       }
       createCategories(function(categories){
          createProducts(companies, categories, function () {
              console.log("---");
              console.log("Finished");
              setTimeout(function(){
                  process.exit(0);
              }, 2000);
          });
       });
    });
});